# Malware scan

This program will statically analyse a given file to determine wheter it might be malicious or not, and what actions should be taken about it. In this project, you will find a scanner and a server. The server let's the scanner connect to it and donwload a database of signatures. The scanner will try to find those signatures inside the provided file and calculate a score. Depending on the score, measures will be recommended to the user.

This project has been entirely coded in Rust using crates to manage all dependencies.

## What is a static analysis

Static analysis is the examination of a file, or code without executing it. It is used to detect errors, vulnerabilities, and adherence to coding standards. It is also used to detect malwares. Once a new malware is discovered, it can be reversed engineered to find signatures (patterns contained in the file). If those signatures are found in another file, it could be another iteration of this malware.

In this project we tried to demonstrate this concept but coding a scanner capable of recognizing snipets of code and keywords inside a file.

## Technologies

<div>
  <img src="https://github.com/devicons/devicon/blob/master/icons/rust/rust-original.svg" title="rust" alt="rust" width="200" height="200"/>
  <img src="https://github.com/geoffrey-diederichs/Malware_scan/blob/main/icon/ngrok.png" title="ngrok" alt="ngrok" width="200" height="200"/>
</div>

## What it contains

- [/scanner_cargo](/scanner_cargo) : rust cargo containing the code and dependecies of the scanner. You can find the source code `main.rs` inside [this folder](/scanner_cargo/src).
- [/server_cargo](/server_cargo) : rust cargo containing the code and dependecies of the server. You can find the source code `main.rs` inside [this folder](/server_cargo/src).
- [/test_files](/test_files) : files used to demonstrate how the project works.
- [icon](/icon) : icon used in this README.

## How to use

First, you need to clone this repository :

```console
$ git clone git@github.com:geoffrey-diederichs/Malware_scan.git

$ cd Malware_scan/
```

Now, we have to start the server. Note that you could run the code without building the executable using the command `cargo run`. To build and run the code :

```console
$ cd server_cargo/

$ cargo build

server > ./target/debug/server_cargo 
Enter the address to be served with this format : address:port
Example : 127.0.0.1:4545

 >>> 127.0.0.1:4545

Server listening on port 4545.
```

Our server is running, let's put it online using ngrok :

```console
$ ngrok tcp 4545
[...]
Forwarding                    tcp://0.tcp.eu.ngrok.io:14994 -> lo
[...]
```

Note that ngrok isn't required : you can do this localy. Let's try our scanner :

```console
$ cd scanner_cargo/

$ cargo build

$ ./target/debug/scanner_cargo 

      __  __       _                                                              
     |  \/  |     | |                                                             
     | \  / | __ _| |_      ____ _ _ __ ___   ___  ___ __ _ _ __  _ __   ___ _ __ 
     | |\/| |/ _` | \ \ /\ / / _` | '__/ _ \ / __|/ __/ _` | '_ \| '_ \ / _ \ '__|
     | |  | | (_| | |\ V  V / (_| | | |  __/ \__ \ (_| (_| | | | | | | |  __/ |   
     |_|  |_|\__,_|_| \_/\_/ \__,_|_|  \___| |___/\___\__,_|_| |_|_| |_|\___|_|   
                                                                              
    
Enter the server's address with this format : address:port
Example : 127.0.0.1:4545

 >>> 0.tcp.eu.ngrok.io:14994

Connected to server.
Database downloaded succesfully.

Enter the full path to the file to be scanned :
 >>>
```

We've connected the server and scanner ! We can also see it from the server :

```console
Server listening on port 4545.
New connection: 127.0.0.1:41748
```

Now let's try to scan a file :

```console
Enter the full path to the file to be scanned :
 >>> ../test_files/hello.txt

Analyzing file...
Keywords found :
 * hello

Final score : 0
Nothing to worry about.
```

The program has scanned one of our harmless test files, he found the keyword `hello` we put there for the demonstrations, but it's worth 0 points. So the total score was 0 : no actions required by the user.
Let's try some different test files :

```console
Enter the full path to the file to be scanned :
 >>> ../test_files/hello_world

Analyzing file...
Keywords found :
 * malware
 * mimikatz
 * hello

Final score : 18
Delete file !
```

This files contains several dangerous keywords, enough to be worried about it and ask the user to take immediate actions.

```console
Enter the full path to the file to be scanned :
 >>> ../test_files/shellcode

Analyzing file...

1 malicious shellcodes found.

Final score : 10
Delete file !
```

This file contains a basic snipet of code trying to allocate memory, copy a shellcode inside of it and execute it : a basic malware behavior. For demonstration purposes, the snipet of code has been considered malicious as you can see by it's score. Now let's try a different file executing the same function but with slight differences, enough to change the binary (you can go and read the source code of those programs [here](/test_files) :

```console
Enter the full path to the file to be scanned :
 >>> ../test_files/shellcode2 

Analyzing file...

1 malicious shellcodes found.

Final score : 10
Delete file !
```

The scanner recognizes the code once again : it doesn't just look for the exact snipet of code, it looks for variations of it, similar enough to be treated the same way.
